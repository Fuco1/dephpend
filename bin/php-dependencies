#!/usr/bin/env php
<?php declare (strict_types = 1);

use Mihaeu\PhpDependencies\Analyser;
use Mihaeu\PhpDependencies\Cli\UmlCommand;
use Mihaeu\PhpDependencies\DependencyInspectionVisitor;
use Mihaeu\PhpDependencies\Parser;
use Mihaeu\PhpDependencies\PlantUmlFormatter;
use Mihaeu\PhpDependencies\PlantUmlWrapper;
use Mihaeu\PhpDependencies\ShellWrapper;
use PhpParser\NodeTraverser;
use PhpParser\ParserFactory;
use Symfony\Component\Console\Application;

require __DIR__.'/../vendor/autoload.php';

$application = new Application();
$application->setName(<<<EOT
      _      _____  _    _ _____               _ 
     | |    |  __ \| |  | |  __ \             | |
   __| | ___| |__) | |__| | |__) |__ _ __   __| |
  / _` |/ _ \  ___/|  __  |  ___/ _ \ '_ \ / _` |
 | (_| |  __/ |    | |  | | |  |  __/ | | | (_| |
  \__,_|\___|_|    |_|  |_|_|   \___|_| |_|\__,_|
EOT
);
$umlCommand = new UmlCommand(
    new \Mihaeu\PhpDependencies\PhpFileFinder(),
    new Parser((new ParserFactory())->create(ParserFactory::PREFER_PHP7)),
    new Analyser(
        new NodeTraverser(),
        new DependencyInspectionVisitor()
    ),
    new PlantUmlWrapper(new PlantUmlFormatter(), new ShellWrapper())
);
$application->add($umlCommand);
$application->run();
